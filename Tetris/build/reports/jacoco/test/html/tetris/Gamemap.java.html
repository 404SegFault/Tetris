<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Gamemap.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Demolition</a> &gt; <a href="index.source.html" class="el_package">demolition</a> &gt; <span class="el_source">Gamemap.java</span></div><h1>Gamemap.java</h1><pre class="source lang-java linenums">package demolition;
import processing.core.PImage;
import java.io.*;
import java.util.*;
import processing.data.JSONObject;

public class Gamemap{
	public static final int HEIGHT = 13;
	public static final int WIDTH = 15;

<span class="fc" id="L11">	private int currentLevelIndex = 0;</span>
	private char[][] mainmap, backmap, foremap;
<span class="fc" id="L13">	private ArrayList&lt;GameObject&gt; allObjects = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L14">	private ArrayList&lt;Enemy&gt; allEnemies = new ArrayList&lt;&gt;();</span>

	private HashMap&lt;String, PImage&gt; allSprites, allExplosionSprites;
	private HashMap&lt;String, PImage[][]&gt; allAnimations;
	private int[] goalCoordinates;
	private App app;
	private Player player;
	private JSONObject config;

	////////////////////////////////////SETUP/////////////////////////////////////
<span class="fc" id="L24">	public Gamemap(HashMap&lt;String, PImage&gt; allSprites, HashMap&lt;String, PImage[][]&gt; allAnimations, HashMap&lt;String, PImage&gt; allExplosionSprites, App app, JSONObject config){</span>
<span class="fc" id="L25">		this.allSprites = allSprites;</span>
<span class="fc" id="L26">		this.allAnimations = allAnimations;</span>
<span class="fc" id="L27">		this.allExplosionSprites = allExplosionSprites;</span>

<span class="fc" id="L29">		this.player = new Player(this.allSprites.get(&quot;player&quot;), 0, 0, this.allAnimations.get(&quot;player&quot;), config.getInt(&quot;lives&quot;));</span>
<span class="fc" id="L30">		player.setMap(this);</span>
		
<span class="fc" id="L32">		this.config = config;</span>
<span class="fc" id="L33">		this.app = app;</span>
<span class="fc" id="L34">	}</span>

	/**
	* takes a 2D array and makes a copy of it
	* @param originalMap
	* @return clonedMap
	**/
	private static char[][] copyMap(char[][] originalMap){
<span class="fc" id="L42">		char[][] clonedMap = new char[HEIGHT][WIDTH];</span>
<span class="fc bfc" id="L43" title="All 2 branches covered.">		for(int i = 0; i &lt; originalMap.length; i ++){</span>
<span class="fc" id="L44">			clonedMap[i] = originalMap[i].clone();</span>
		}

<span class="fc" id="L47">		return clonedMap;</span>
	}

	/**
	* given a filepath to a txt file it will create a 2D character array with all the symbols needed to load the objects from the map 
	* @param filepath needs a file path to a txt file to where a map is
	**/
	public void loadMap(String filepath){
<span class="fc" id="L55">		mainmap = new char[HEIGHT][WIDTH];</span>
<span class="fc" id="L56">		backmap = new char[HEIGHT][WIDTH];</span>
<span class="fc" id="L57">		foremap = new char[HEIGHT][WIDTH];</span>
		try {
			// -------------------------LOADING THE MAIN MAP--------------------------
<span class="fc" id="L60">			File f = new File(filepath);</span>
<span class="fc" id="L61">			Scanner sc = new Scanner(f);</span>
		
<span class="fc" id="L63">			int rowIndex = 0;</span>
			// scans the entire map
<span class="fc bfc" id="L65" title="All 2 branches covered.">			while (sc.hasNext()){</span>
<span class="fc" id="L66">				String row =  sc.nextLine();</span>
<span class="fc" id="L67">				char[] rowInCharacters = row.toCharArray(); </span>
				// sets the row to the characters
<span class="fc" id="L69">				mainmap[rowIndex] = rowInCharacters;</span>
<span class="fc" id="L70">				rowIndex ++;</span>
<span class="fc" id="L71">			}</span>

			// ------------------------LOADING BACKGROUND MAP---------------------------
			// only gets the background images
<span class="fc" id="L75">			this.backmap = copyMap(this.mainmap);</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">			for (char[] row : backmap){</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">				for (int i = 0; i &lt; row.length; i ++){</span>
<span class="fc" id="L78">					char symbol = row[i];</span>
					// if the symbol is the player, the broken wall of the either of the enemies the space behind it should be blank
<span class="fc bfc" id="L80" title="All 6 branches covered.">					if (symbol != 'W' &amp;&amp; symbol != ' ' &amp;&amp; symbol != 'G'){</span>
<span class="fc" id="L81">						row[i] = ' ';</span>
					}
				}
			}

			// -----------------------LOADING FOREGROUND MAP----------------------------
			// just gets the symbols it needs to spawn on top of the background
<span class="fc" id="L88">			this.foremap = copyMap(this.mainmap);</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">			for (char[] row : foremap){</span>
<span class="fc bfc" id="L90" title="All 2 branches covered.">				for (int i = 0; i &lt; row.length; i ++){</span>
<span class="fc" id="L91">					char symbol = row[i];</span>
					// if the symbol is a wall it is replaced
<span class="fc bfc" id="L93" title="All 4 branches covered.">					if (symbol == 'W' || symbol == 'G'){</span>
<span class="fc" id="L94">						row[i] = ' ';</span>
					}
				}
			}
		}
<span class="nc" id="L99">		catch (FileNotFoundException e) { </span>
<span class="nc" id="L100"> 			e.printStackTrace();</span>
<span class="fc" id="L101">		}</span>
		
<span class="fc" id="L103">		this.allObjects = new ArrayList&lt;GameObject&gt;();</span>
<span class="fc" id="L104">		this.allEnemies = new ArrayList&lt;Enemy&gt;();</span>
<span class="fc" id="L105">	}</span>

	/**
	* given a config file it can get the filepaths needed to load the map, once the map is loaded all of the objects are created (with the coordinates they should be drawn at) from the classes and placed into an arraylist with all the objects
	* @param config needs the configuration json to know the names of the files
	**/
	public void loadLevel(JSONObject config){
		//App.GRIDSPACE * 2 offset from where the game map actually starts
<span class="fc" id="L113">		String levelFilePath = config.getJSONArray(&quot;levels&quot;).getJSONObject(currentLevelIndex).getString(&quot;path&quot;);</span>
<span class="fc" id="L114">		loadMap(levelFilePath);</span>

<span class="fc" id="L116">		int cursorY = App.GRIDSPACE * 2;</span>
<span class="fc" id="L117">		int cursorX = 0;</span>

		//--------------------------------LOADING THE SPRITES FROM THE MAP------------------------------------
		
<span class="fc" id="L121">		char[][] backgroundMap = this.backmap;</span>

<span class="fc bfc" id="L123" title="All 2 branches covered.">		for (char[] row : backgroundMap){</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">			for (char symbol: row){</span>
<span class="fc" id="L125">				GameObject newObject = null;</span>
				// paints the image of the ground if its empty
<span class="fc bfc" id="L127" title="All 2 branches covered.">				if (symbol == ' '){</span>
<span class="fc" id="L128">					newObject = new Flat(this.allSprites.get(&quot;empty&quot;), cursorX, cursorY);</span>
				} 
				// creates a new wall at the coordinates where the wall will be drawn on later
<span class="fc bfc" id="L131" title="All 2 branches covered.">				if (symbol == 'W') {</span>
<span class="fc" id="L132">					newObject = new Wall(this.allSprites.get(&quot;wall&quot;), cursorX, cursorY);</span>
				}
<span class="fc bfc" id="L134" title="All 2 branches covered.">				if (symbol == 'G'){</span>
<span class="fc" id="L135">					newObject = new Flat(this.allSprites.get(&quot;goal&quot;), cursorX, cursorY);</span>
<span class="fc" id="L136">					this.goalCoordinates = new int[]{cursorX, cursorY};</span>
				}

				//moves to the next position of where the sprite should spawn 
<span class="fc" id="L140">				allObjects.add(newObject);</span>
<span class="fc" id="L141">				cursorX += App.GRIDSPACE;</span>
			}
<span class="fc" id="L143">			cursorX = 0;</span>
<span class="fc" id="L144">			cursorY += App.GRIDSPACE;</span>
		}

		//------------------------------------FOREGROUND MAP-----------------------------------------
<span class="fc" id="L148">		cursorX = 0;</span>
<span class="fc" id="L149">		cursorY = App.GRIDSPACE * 2;</span>
<span class="fc" id="L150">		char[][] foregroundMap = this.foremap;</span>

		// these are all the initial sprites for the player and the enemies idk how to do it otherwise rn
<span class="fc bfc" id="L153" title="All 2 branches covered.">		for (char[] row : foregroundMap){</span>
		
<span class="fc bfc" id="L155" title="All 2 branches covered.">			for (char symbol: row){</span>
<span class="fc bfc" id="L156" title="All 2 branches covered.">				if (symbol != ' '){</span>
<span class="fc bfc" id="L157" title="All 2 branches covered.">					if (symbol == 'P'){</span>
<span class="fc" id="L158">						this.player.setCoord(cursorX, cursorY - App.GRIDSPACE);</span>
<span class="fc" id="L159">						allObjects.add(this.player);</span>
					} 
<span class="fc bfc" id="L161" title="All 2 branches covered.">					if (symbol == 'R') {</span>
<span class="fc" id="L162">						Enemy newEnemy = new RedEnemy(this.allSprites.get(&quot;red&quot;), cursorX, cursorY, allAnimations.get(&quot;red&quot;));</span>
<span class="fc" id="L163">						allEnemies.add(newEnemy);</span>
<span class="fc" id="L164">						allObjects.add(newEnemy);</span>
					}
<span class="fc bfc" id="L166" title="All 2 branches covered.">					if (symbol == 'Y') {</span>
<span class="fc" id="L167">						Enemy newEnemy = new YellowEnemy(this.allSprites.get(&quot;yellow&quot;), cursorX, cursorY, allAnimations.get(&quot;yellow&quot;));</span>
<span class="fc" id="L168">						allEnemies.add(newEnemy);</span>
<span class="fc" id="L169">						allObjects.add(newEnemy);</span>
					} 
<span class="fc bfc" id="L171" title="All 2 branches covered.">					if (symbol == 'B') {</span>
<span class="fc" id="L172">						BrokenWall newObject = new BrokenWall(this.allSprites.get(&quot;broken&quot;), cursorX, cursorY);</span>
<span class="fc" id="L173">						allObjects.add(newObject);</span>
					}
				}
				
<span class="fc" id="L177">				cursorX += App.GRIDSPACE;</span>
			}
<span class="fc" id="L179">			cursorX = 0;</span>
<span class="fc" id="L180">			cursorY += App.GRIDSPACE;</span>
		}

<span class="fc" id="L183">	}</span>

	//////////////////////MANIPULATION OF THE OBJECTS LIST//////////////////
	/**check all the objects on the map and removes any objects that have been marked as should be removed**/
	public void tick(){
<span class="fc bfc" id="L188" title="All 2 branches covered.">		for (int i = 0; i &lt; allObjects.size(); i++){</span>
<span class="fc" id="L189">			GameObject object = allObjects.get(i);</span>
			
<span class="fc bfc" id="L191" title="All 2 branches covered.">			if (object.shouldBeRemoved()) {</span>
<span class="fc" id="L192">				allObjects.remove(object);</span>

<span class="fc bfc" id="L194" title="All 2 branches covered.">				if (object instanceof Enemy){</span>
<span class="fc" id="L195">					allEnemies.remove(object);</span>
				}
			}
		}
<span class="fc" id="L199">	}</span>

<span class="fc" id="L201">	public void addNewObject(GameObject gameObject) {this.allObjects.add(gameObject);}</span>
	
	/** 
	* Finds the object at the same coordinates given inside the parameters
	* @param coords the coordinates where the object is located
	* @return the object at the coordinates
	**/
	public GameObject findCollisionObject(int[] coords){
		// updates this object with the newest one
<span class="fc" id="L210">		GameObject upperMostObject = null;</span>
		
<span class="fc bfc" id="L212" title="All 2 branches covered.">		for (GameObject object : this.allObjects){</span>
<span class="fc" id="L213">			int[] objectCoords = object.getCoords();</span>
		
<span class="fc bfc" id="L215" title="All 2 branches covered.">			if (Arrays.equals(objectCoords, coords)){</span>
<span class="fc" id="L216">				upperMostObject = object;</span>
			}
<span class="fc" id="L218">		}</span>
<span class="fc" id="L219">		return upperMostObject;</span>
	}
	
	/** 
	* Finds the object at the same coordinates given inside the parameters and makes sure that the object that is trying to find the second object at the specified coordinates, doesnt find itself 
	* @param searchingObject,coords the object is trying to find the other and the coordinates where the object is located
	* @return the object at the coordinates 
	**/
	public GameObject findCollisionObject(GameObject searchingObject, int[] coords){
		// updates this object with the newest one
<span class="fc" id="L229">		GameObject upperMostObject = null;</span>
		
<span class="fc bfc" id="L231" title="All 2 branches covered.">		for (GameObject object : this.allObjects){</span>
<span class="fc" id="L232">			int[] objectCoords = object.getCoords();</span>
		
<span class="fc bfc" id="L234" title="All 4 branches covered.">			if (Arrays.equals(objectCoords, coords) &amp;&amp; (searchingObject != object)){</span>
<span class="fc" id="L235">				upperMostObject = object;</span>
			}
<span class="fc" id="L237">		}</span>
<span class="fc" id="L238">		return upperMostObject;</span>
	}

	// public Cardinal[] allowedMoved

	/////////////////////////////////GAME CONDITIONS///////////////////////////////

	/**deducts life from player, clears all objects, and resets the level**/
	public void playerHit(){
<span class="fc" id="L247">		this.player.minusLife();</span>
<span class="fc" id="L248">		this.allObjects.clear();</span>
<span class="fc" id="L249">		this.allEnemies.clear();</span>
<span class="fc" id="L250">		loadLevel(config);</span>
<span class="fc" id="L251">	}</span>

	/**clears all the objects, increments the level index, if the current level index is the same as the number of levels specified in the JSON file it will activate the win condition inside app, otherwise the next level is loaded**/
	public void loadNextLevel(){
<span class="fc" id="L255">		this.allObjects.clear(); </span>
<span class="fc" id="L256">		this.allEnemies.clear();</span>
<span class="fc" id="L257">		currentLevelIndex++;</span>
		
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">		if (currentLevelIndex &gt;= config.getJSONArray(&quot;levels&quot;).size()){</span>
<span class="nc" id="L260">			app.gameWon();</span>
		} 
		
		else {
<span class="fc" id="L264">			app.setTime(config.getJSONArray(&quot;levels&quot;).getJSONObject(currentLevelIndex).getInt(&quot;time&quot;));</span>
<span class="fc" id="L265">			loadLevel(config);</span>
		}
<span class="fc" id="L267">	}</span>

	//////////////////////////////DEALING WITH BOMBS///////////////////////////////////
	public void placeBomb(){
<span class="fc" id="L271">		Bomb newBomb = new Bomb(allSprites.get(&quot;bomb&quot;), player.getCoords()[0], player.getCoords()[1], allAnimations.get(&quot;bomb&quot;)[0], this); </span>
<span class="fc" id="L272">		this.addNewObject(newBomb);</span>
<span class="fc" id="L273">	}</span>

	////////////////////////////////////GETTERS///////////////////////////////
<span class="fc" id="L276">	public Player getPlayer() {return this.player;}</span>
<span class="fc" id="L277">	public int[] getGoalCoordinates() {return this.goalCoordinates;}</span>
	
<span class="fc" id="L279">	public HashMap&lt;String, PImage&gt; getAllExplosionSprites() {return this.allExplosionSprites;}</span>
<span class="fc" id="L280">	public HashMap&lt;String, PImage&gt; getAllSprites() {return this.allSprites;}</span>
<span class="fc" id="L281">	public HashMap&lt;String, PImage[][]&gt; getAllAnimations() {return this.allAnimations;}</span>

<span class="fc" id="L283">	public ArrayList&lt;GameObject&gt; getAllObjects(){return this.allObjects;}</span>
<span class="fc" id="L284">	public ArrayList&lt;Enemy&gt; getAllEnemies(){return this.allEnemies;}</span>

<span class="fc" id="L286">	public int getCurrentLevelIndex(){return this.currentLevelIndex;}</span>
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>